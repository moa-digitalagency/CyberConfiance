{% extends "base.html" %}

{% block title %}Analyseur de Code GitHub - CyberConfiance{% endblock %}

{% block content %}
<section class="page-header-modern">
    <div class="container">
        <div class="header-content-centered">
            <h1 class="page-title-modern">Analyseur de <span style="color: #3b82f6;">Code GitHub</span></h1>
            <span style="display: inline-block; background: linear-gradient(135deg, #f59e0b, #d97706); color: #000 !important; font-size: 14px; padding: 6px 16px; border-radius: 20px; margin-top: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 2px 10px rgba(245, 158, 11, 0.4);">BETA</span>
            <p class="page-subtitle-modern">Audit de sécurité complet et analyse de la qualité du code</p>
        </div>
    </div>
</section>

<section class="analyzer-container">
    <div class="container">
        {% if not results %}
        <div class="analyzer-card">
            <h2>Analyse de Sécurité du Code</h2>
            <p class="analyzer-description">
                Analysez n'importe quel dépôt GitHub public pour détecter les failles de sécurité, 
                les secrets exposés, les dépendances vulnérables, les patterns de code toxiques (vibecoding), 
                et évaluez la qualité globale du projet.
            </p>

            <form method="POST" action="{{ url_for('main.github_analyzer') }}" class="analyzer-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                
                <div class="form-group">
                    <label for="repoUrl">URL du dépôt GitHub</label>
                    <input 
                        type="url" 
                        name="repo_url" 
                        id="repoUrl" 
                        placeholder="https://github.com/owner/repository"
                        pattern="https://github\.com/[a-zA-Z0-9\-_]+/[a-zA-Z0-9\-_\.]+"
                        required
                        class="form-control"
                    >
                </div>

                <div class="form-group">
                    <label for="branch">Branche (optionnel)</label>
                    <input 
                        type="text" 
                        name="branch" 
                        id="branch" 
                        placeholder="main"
                        value="main"
                        class="form-control"
                    >
                </div>
                
                <button type="submit" class="btn-primary btn-full" id="analyzeBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
                    </svg>
                    <span>Analyser le Dépôt</span>
                </button>
            </form>
            
            <div style="padding: 20px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); border-left: 3px solid #ef4444; border-radius: 8px; margin-top: 1.5rem;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    <h4 style="color: #ef4444; font-size: 1rem; font-weight: 700; margin: 0;">Analyses de Sécurité Incluses</h4>
                </div>
                <ul style="margin: 0; padding-left: 20px; color: #94a3b8; font-size: 0.875rem; line-height: 1.8;">
                    <li><strong>Secrets exposés</strong> : API keys, tokens, mots de passe hardcodés</li>
                    <li><strong>Injection SQL</strong> : Requêtes non paramétrées, concaténations dangereuses</li>
                    <li><strong>XSS</strong> : innerHTML, document.write, templates non échappés</li>
                    <li><strong>Command Injection</strong> : shell=True, eval(), exec()</li>
                    <li><strong>Path Traversal</strong> : Accès fichiers non validés</li>
                    <li><strong>Désérialisation</strong> : pickle, yaml.load non sécurisé</li>
                    <li><strong>Configurations à risque</strong> : DEBUG=True, CORS wildcard</li>
                </ul>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 1.5rem;">
                <div style="padding: 15px; background: rgba(168, 85, 247, 0.1); border-radius: 8px; border: 1px solid rgba(168, 85, 247, 0.2);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                        <strong style="color: #a855f7; font-size: 0.85rem;">Patterns IA Toxiques</strong>
                    </div>
                    <p style="margin: 0; color: #94a3b8; font-size: 0.8rem;">Détection du "vibecoding" : TODO non résolus, fonctions dupliquées, exceptions silencieuses</p>
                </div>

                <div style="padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2">
                            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                            <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                            <line x1="12" y1="22.08" x2="12" y2="12"/>
                        </svg>
                        <strong style="color: #3b82f6; font-size: 0.85rem;">Architecture & Structure</strong>
                    </div>
                    <p style="margin: 0; color: #94a3b8; font-size: 0.8rem;">Organisation des fichiers, conventions de nommage, présence de tests</p>
                </div>

                <div style="padding: 15px; background: rgba(34, 197, 94, 0.1); border-radius: 8px; border: 1px solid rgba(34, 197, 94, 0.2);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 6v6l4 2"/>
                        </svg>
                        <strong style="color: #22c55e; font-size: 0.85rem;">Git & Documentation</strong>
                    </div>
                    <p style="margin: 0; color: #94a3b8; font-size: 0.8rem;">Qualité des commits, fichiers sensibles dans l'historique, README complet</p>
                </div>

                <div style="padding: 15px; background: rgba(251, 146, 60, 0.1); border-radius: 8px; border: 1px solid rgba(251, 146, 60, 0.2);">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fb923c" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                        <strong style="color: #fb923c; font-size: 0.85rem;">Performance</strong>
                    </div>
                    <p style="margin: 0; color: #94a3b8; font-size: 0.8rem;">Boucles infinies, requêtes N+1, SELECT *, variables globales</p>
                </div>
            </div>
        </div>
        {% endif %}

        {% if results %}
        <div class="results-card">
            {% if results.error %}
            <div class="alert alert-error">
                <h3>Erreur d'analyse</h3>
                <p>{{ results.message }}</p>
                <a href="{{ url_for('main.github_analyzer') }}" class="btn-secondary" style="margin-top: 1rem; display: inline-block;">Réessayer</a>
            </div>
            {% else %}
            
            <div class="repo-header" style="display: flex; align-items: center; gap: 15px; padding: 20px; background: rgba(59, 130, 246, 0.1); border-radius: 12px; margin-bottom: 25px;">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="1.5">
                    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
                </svg>
                <div>
                    <h3 style="margin: 0; font-size: 1.3rem;">{{ results.repo_owner }}/{{ results.repo_name }}</h3>
                    <p style="margin: 5px 0 0 0; color: #94a3b8; font-size: 0.9rem;">
                        Branche: <strong>{{ results.branch }}</strong> | Commit: <code>{{ results.commit_hash }}</code> | Durée: {{ results.analysis_duration }}s
                    </p>
                </div>
            </div>

            <div class="score-overview" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="score-card overall" style="padding: 25px; background: linear-gradient(135deg, 
                    {% if results.risk_level == 'critical' %}rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1){% elif results.risk_level == 'high' %}rgba(251, 146, 60, 0.2), rgba(251, 146, 60, 0.1){% elif results.risk_level == 'medium' %}rgba(234, 179, 8, 0.2), rgba(234, 179, 8, 0.1){% else %}rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1){% endif %}); border-radius: 12px; text-align: center;">
                    <div style="font-size: 3rem; font-weight: 800; color: {% if results.risk_level == 'critical' %}#ef4444{% elif results.risk_level == 'high' %}#fb923c{% elif results.risk_level == 'medium' %}#eab308{% else %}#22c55e{% endif %};">{{ results.overall_score }}%</div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">Score Global</div>
                    <div class="risk-badge" style="display: inline-block; margin-top: 10px; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase;
                        background: {% if results.risk_level == 'critical' %}rgba(239, 68, 68, 0.3){% elif results.risk_level == 'high' %}rgba(251, 146, 60, 0.3){% elif results.risk_level == 'medium' %}rgba(234, 179, 8, 0.3){% else %}rgba(34, 197, 94, 0.3){% endif %};
                        color: {% if results.risk_level == 'critical' %}#ef4444{% elif results.risk_level == 'high' %}#fb923c{% elif results.risk_level == 'medium' %}#eab308{% else %}#22c55e{% endif %};">
                        Risque {{ results.risk_level|capitalize }}
                    </div>
                </div>

                <div class="score-card security" style="padding: 25px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05)); border-radius: 12px; text-align: center; border: 2px solid rgba(239, 68, 68, 0.3);">
                    <div style="font-size: 2.5rem; font-weight: 800; color: #ef4444;">{{ results.security_score }}%</div>
                    <div style="font-size: 0.9rem; color: #94a3b8; margin-top: 5px;">Score Sécurité</div>
                    <div style="font-size: 0.75rem; color: #ef4444; margin-top: 8px;">Priorité #1</div>
                </div>

                <div class="score-card stats" style="padding: 25px; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center;">
                        <div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #3b82f6;">{{ results.total_files_analyzed }}</div>
                            <div style="font-size: 0.75rem; color: #94a3b8;">Fichiers</div>
                        </div>
                        <div>
                            <div style="font-size: 1.8rem; font-weight: 700; color: #ef4444;">{{ results.total_issues_found }}</div>
                            <div style="font-size: 0.75rem; color: #94a3b8;">Problèmes</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="issues-summary" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 25px; justify-content: center;">
                <span style="padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: rgba(239, 68, 68, 0.2); color: #ef4444;">
                    {{ results.critical_issues }} Critiques
                </span>
                <span style="padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: rgba(251, 146, 60, 0.2); color: #fb923c;">
                    {{ results.high_issues }} Élevés
                </span>
                <span style="padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: rgba(234, 179, 8, 0.2); color: #eab308;">
                    {{ results.medium_issues }} Moyens
                </span>
                <span style="padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; background: rgba(59, 130, 246, 0.2); color: #3b82f6;">
                    {{ results.low_issues }} Faibles
                </span>
            </div>

            {% if results.languages_detected %}
            <div style="margin-bottom: 25px; padding: 15px; background: rgba(168, 85, 247, 0.1); border-radius: 10px;">
                <strong style="color: #a855f7;">Langages détectés:</strong>
                {% for lang, count in results.languages_detected.items() %}
                <span style="margin-left: 10px; padding: 3px 10px; background: rgba(168, 85, 247, 0.2); border-radius: 12px; font-size: 0.8rem;">{{ lang }} ({{ count }})</span>
                {% endfor %}
                {% if results.frameworks_detected %}
                <br><strong style="color: #a855f7; margin-top: 8px; display: inline-block;">Frameworks:</strong>
                {% for framework in results.frameworks_detected %}
                <span style="margin-left: 10px; padding: 3px 10px; background: rgba(59, 130, 246, 0.2); border-radius: 12px; font-size: 0.8rem; color: #3b82f6;">{{ framework }}</span>
                {% endfor %}
                {% endif %}
            </div>
            {% endif %}

            {% if results.analysis_summary %}
            <div style="padding: 20px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #3b82f6;">
                <p style="margin: 0; color: #e2e8f0; line-height: 1.6;">{{ results.analysis_summary }}</p>
            </div>
            {% endif %}

            {% if results.security_findings %}
            <div class="findings-section" style="margin-bottom: 30px;">
                <h3 style="display: flex; align-items: center; gap: 10px; color: #ef4444; margin-bottom: 15px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    Vulnérabilités de Sécurité ({{ results.security_findings|length }})
                </h3>
                <div class="issues-list">
                    {% for finding in results.security_findings %}
                    <div class="issue-item severity-{{ finding.severity }}" style="padding: 15px; margin-bottom: 10px; background: rgba(239, 68, 68, 0.05); border-radius: 8px; border-left: 4px solid {% if finding.severity == 'critical' %}#ef4444{% elif finding.severity == 'high' %}#fb923c{% elif finding.severity == 'medium' %}#eab308{% else %}#3b82f6{% endif %};">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 10px;">
                            <div>
                                <span class="severity-badge" style="display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; margin-right: 8px;
                                    background: {% if finding.severity == 'critical' %}rgba(239, 68, 68, 0.3){% elif finding.severity == 'high' %}rgba(251, 146, 60, 0.3){% elif finding.severity == 'medium' %}rgba(234, 179, 8, 0.3){% else %}rgba(59, 130, 246, 0.3){% endif %};
                                    color: {% if finding.severity == 'critical' %}#ef4444{% elif finding.severity == 'high' %}#fb923c{% elif finding.severity == 'medium' %}#eab308{% else %}#3b82f6{% endif %};">
                                    {{ finding.severity }}
                                </span>
                                <strong style="color: #e2e8f0;">{{ finding.title }}</strong>
                            </div>
                        </div>
                        <div style="margin-top: 8px; font-size: 0.85rem; color: #94a3b8;">
                            <code style="background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">{{ finding.file }}:{{ finding.line }}</code>
                        </div>
                        {% if finding.evidence %}
                        <div style="margin-top: 8px; padding: 10px; background: rgba(0,0,0,0.4); border-radius: 4px; font-family: 'Fira Code', 'Monaco', monospace; font-size: 0.85rem; color: #e2e8f0; overflow-x: auto; white-space: pre-wrap; word-break: break-all;">{{ finding.evidence }}</div>
                        {% endif %}
                        {% if finding.context %}
                        <details style="margin-top: 8px;">
                            <summary style="cursor: pointer; color: #64748b; font-size: 0.8rem;">Voir le contexte (lignes environnantes)</summary>
                            <pre style="margin-top: 5px; padding: 10px; background: rgba(0,0,0,0.5); border-radius: 4px; font-size: 0.75rem; color: #94a3b8; overflow-x: auto;">{{ finding.context }}</pre>
                        </details>
                        {% endif %}
                        <div style="margin-top: 8px; font-size: 0.8rem; color: #22c55e;">
                            <strong>Correction:</strong> {{ finding.remediation }}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if results.toxic_ai_patterns %}
            <div class="findings-section" style="margin-bottom: 30px;">
                <h3 style="display: flex; align-items: center; gap: 10px; color: #a855f7; margin-bottom: 15px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                    </svg>
                    Patterns IA Toxiques / Vibecoding ({{ results.toxic_ai_patterns|length }})
                </h3>
                <div class="issues-list">
                    {% for finding in results.toxic_ai_patterns %}
                    <div class="issue-item" style="padding: 12px; margin-bottom: 8px; background: rgba(168, 85, 247, 0.05); border-radius: 8px; border-left: 3px solid #a855f7;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 8px;">
                            <strong style="color: #a855f7;">{{ finding.title }}</strong>
                            <code style="font-size: 0.8rem; color: #94a3b8; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">{{ finding.file }}:{{ finding.line }}</code>
                        </div>
                        {% if finding.evidence %}
                        <div style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.4); border-radius: 4px; font-family: 'Fira Code', 'Monaco', monospace; font-size: 0.85rem; color: #e2e8f0; overflow-x: auto; white-space: pre-wrap;">{{ finding.evidence }}</div>
                        {% endif %}
                        {% if finding.remediation %}
                        <div style="margin-top: 6px; font-size: 0.8rem; color: #22c55e;">
                            <strong>Correction:</strong> {{ finding.remediation }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if results.dependency_findings %}
            <div class="findings-section" style="margin-bottom: 30px;">
                <h3 style="display: flex; align-items: center; gap: 10px; color: #fb923c; margin-bottom: 15px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                    </svg>
                    Dépendances ({{ results.dependency_findings|length }})
                </h3>
                <div class="issues-list">
                    {% for finding in results.dependency_findings %}
                    <div class="issue-item" style="padding: 12px; margin-bottom: 8px; background: rgba(251, 146, 60, 0.05); border-radius: 8px; border-left: 3px solid #fb923c;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 8px;">
                            <strong style="color: #fb923c;">{{ finding.title }}</strong>
                            <code style="font-size: 0.8rem; color: #94a3b8; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">{{ finding.file }}{% if finding.line %}:{{ finding.line }}{% endif %}</code>
                        </div>
                        {% if finding.evidence %}
                        <div style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.4); border-radius: 4px; font-family: monospace; font-size: 0.85rem; color: #e2e8f0; overflow-x: auto;">{{ finding.evidence }}</div>
                        {% endif %}
                        {% if finding.remediation %}
                        <div style="margin-top: 6px; font-size: 0.8rem; color: #22c55e;">
                            <strong>Correction:</strong> {{ finding.remediation }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if results.architecture_findings %}
            <div class="findings-section" style="margin-bottom: 30px;">
                <h3 style="display: flex; align-items: center; gap: 10px; color: #3b82f6; margin-bottom: 15px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    Architecture & Structure ({{ results.architecture_findings|length }})
                </h3>
                <div class="issues-list">
                    {% for finding in results.architecture_findings %}
                    <div class="issue-item" style="padding: 12px; margin-bottom: 8px; background: rgba(59, 130, 246, 0.05); border-radius: 8px; border-left: 3px solid #3b82f6;">
                        <strong style="color: #3b82f6;">{{ finding.title }}</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.85rem; color: #94a3b8;">{{ finding.remediation }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if results.performance_findings %}
            <div class="findings-section" style="margin-bottom: 30px;">
                <h3 style="display: flex; align-items: center; gap: 10px; color: #eab308; margin-bottom: 15px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                    </svg>
                    Performance ({{ results.performance_findings|length }})
                </h3>
                <div class="issues-list">
                    {% for finding in results.performance_findings %}
                    <div class="issue-item" style="padding: 12px; margin-bottom: 8px; background: rgba(234, 179, 8, 0.05); border-radius: 8px; border-left: 3px solid #eab308;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; flex-wrap: wrap; gap: 8px;">
                            <strong style="color: #eab308;">{{ finding.title }}</strong>
                            <code style="font-size: 0.8rem; color: #94a3b8; background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px;">{{ finding.file }}:{{ finding.line }}</code>
                        </div>
                        {% if finding.evidence %}
                        <div style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.4); border-radius: 4px; font-family: monospace; font-size: 0.85rem; color: #e2e8f0; overflow-x: auto;">{{ finding.evidence }}</div>
                        {% endif %}
                        {% if finding.remediation %}
                        <div style="margin-top: 6px; font-size: 0.8rem; color: #22c55e;">
                            <strong>Correction:</strong> {{ finding.remediation }}
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if results.git_hygiene_findings %}
            <div class="findings-section" style="margin-bottom: 30px;">
                <h3 style="display: flex; align-items: center; gap: 10px; color: #22c55e; margin-bottom: 15px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="4"/>
                        <line x1="1.05" y1="12" x2="7" y2="12"/>
                        <line x1="17.01" y1="12" x2="22.96" y2="12"/>
                    </svg>
                    Hygiène Git ({{ results.git_hygiene_findings|length }})
                </h3>
                <div class="issues-list">
                    {% for finding in results.git_hygiene_findings %}
                    <div class="issue-item" style="padding: 12px; margin-bottom: 8px; background: rgba(34, 197, 94, 0.05); border-radius: 8px; border-left: 3px solid {% if finding.severity == 'critical' %}#ef4444{% elif finding.severity == 'high' %}#fb923c{% else %}#22c55e{% endif %};">
                        <strong style="color: {% if finding.severity == 'critical' %}#ef4444{% elif finding.severity == 'high' %}#fb923c{% else %}#22c55e{% endif %};">{{ finding.title }}</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.85rem; color: #94a3b8;">{{ finding.remediation }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if results.documentation_findings %}
            <div class="findings-section" style="margin-bottom: 30px;">
                <h3 style="display: flex; align-items: center; gap: 10px; color: #06b6d4; margin-bottom: 15px;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Documentation ({{ results.documentation_findings|length }})
                </h3>
                <div class="issues-list">
                    {% for finding in results.documentation_findings %}
                    <div class="issue-item" style="padding: 12px; margin-bottom: 8px; background: rgba(6, 182, 212, 0.05); border-radius: 8px; border-left: 3px solid #06b6d4;">
                        <strong style="color: #06b6d4;">{{ finding.title }}</strong>
                        <p style="margin: 5px 0 0 0; font-size: 0.85rem; color: #94a3b8;">{{ finding.remediation }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <div style="margin-top: 2rem; text-align: center; display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                {% if analysis_id %}
                <a href="{{ url_for('main.generate_github_pdf', analysis_id=analysis_id) }}" class="btn-primary" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; text-decoration: none;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    <span>Télécharger le Rapport PDF</span>
                </a>
                {% endif %}
                <a href="{{ url_for('main.github_analyzer') }}" class="btn-secondary" style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; text-decoration: none;">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
                    </svg>
                    <span>Nouvelle Analyse</span>
                </a>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</section>

<style>
.analyzer-form .form-group {
    margin-bottom: 1.5rem;
}

.analyzer-form .form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #e2e8f0;
}

.analyzer-form .form-control {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid rgba(59, 130, 246, 0.3);
    border-radius: 8px;
    background: rgba(15, 23, 42, 0.6);
    color: #e2e8f0;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.analyzer-form .form-control:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

.analyzer-form .form-control::placeholder {
    color: #64748b;
}

#analyzeBtn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

@media (max-width: 768px) {
    .score-overview {
        grid-template-columns: 1fr !important;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.analyzer-form');
    const btn = document.getElementById('analyzeBtn');
    
    if (form && btn) {
        form.addEventListener('submit', function() {
            btn.disabled = true;
            btn.innerHTML = '<svg class="spinner" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/></svg><span>Analyse en cours... (peut prendre 30-60 secondes)</span>';
        });
    }
});
</script>
{% endblock %}
