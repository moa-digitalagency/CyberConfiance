{% extends "base.html" %}

{% block title %}Scénarios d'Attaque - CyberConfiance{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Scénarios d'Attaque</h1>
        <p>Apprenez à reconnaître et à vous protéger contre les cybermenaces actuelles</p>
    </div>
</section>

<section class="content-section">
    <div class="container">
        {% if scenarios %}
        <div class="scenarios-grid">
            {% for scenario in scenarios %}
            <div class="scenario-card glass-card">
                <h3>{{ scenario.title }}</h3>
                <div class="scenario-description">{{ scenario.description|safe }}</div>
                
                {% if scenario.severity %}
                <div class="scenario-severity">
                    <span class="severity-badge severity-{{ scenario.severity|lower }}">{{ scenario.severity }}</span>
                </div>
                {% endif %}
                
                {% if scenario.threat_type %}
                <div class="scenario-threat-type">
                    <strong>Type de menace :</strong> {{ scenario.threat_type }}
                </div>
                {% endif %}
                
                <div class="scenario-rules-links"></div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Aucun scénario disponible pour le moment.</p>
        {% endif %}
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const scenarioCards = document.querySelectorAll('.scenario-card');
    
    scenarioCards.forEach(card => {
        const descriptionDiv = card.querySelector('.scenario-description');
        const rulesContainer = card.querySelector('.scenario-rules-links');
        
        if (!descriptionDiv || !rulesContainer) return;
        
        // Lire le contenu texte
        const description = descriptionDiv.textContent;
        
        // Chercher le pattern "Règles d'or appliquées :" suivi de nombres
        const match = description.match(/Règles d['']or appliquées[^:]*:\s*([0-9,\s]+)/i);
        
        if (match && match[1]) {
            // Extraire les numéros
            const ruleNumbers = match[1].trim().split(/[,\s]+/).filter(n => n && !isNaN(n));
            
            if (ruleNumbers.length > 0) {
                // Trouver et supprimer l'élément <p> qui contient "Règles d'or appliquées"
                const paragraphs = descriptionDiv.querySelectorAll('p');
                paragraphs.forEach(p => {
                    if (p.textContent.includes("Règles d'or appliquées") || p.textContent.includes("Règles d'or appliquées")) {
                        p.remove();
                    }
                });
                
                // Créer le HTML avec les bons liens vers /rules/{id}
                let html = '<h4>Règles d\'or à appliquer :</h4><div class="rules-buttons">';
                ruleNumbers.forEach(num => {
                    html += `<a href="/rules/${num}" class="rule-link-button">Règle ${num}</a>`;
                });
                html += '</div>';
                rulesContainer.innerHTML = html;
                rulesContainer.style.display = 'block';
            }
        }
    });
});
</script>
{% endblock %}
