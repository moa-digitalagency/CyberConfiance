{% extends "base.html" %}

{% block title %}Sc√©narios d'Attaque - CyberConfiance{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Sc√©narios d'Attaque</h1>
        <p>Apprenez √† reconna√Ætre et √† vous prot√©ger contre les cybermenaces actuelles</p>
    </div>
</section>

<section class="content-section">
    <div class="container">
        {% if scenarios %}
        <div class="scenarios-grid">
            {% for scenario in scenarios %}
            <div class="scenario-card glass-card">
                <h3>{{ scenario.title }}</h3>
                <div class="scenario-description">{{ scenario.description|safe }}</div>
                
                {% if scenario.severity %}
                <div class="scenario-severity">
                    <span class="severity-badge severity-{{ scenario.severity|lower }}">{{ scenario.severity }}</span>
                </div>
                {% endif %}
                
                {% if scenario.threat_type %}
                <div class="scenario-threat-type">
                    <strong>Type de menace :</strong> {{ scenario.threat_type }}
                </div>
                {% endif %}
                
                <div class="scenario-rules-links"></div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Aucun sc√©nario disponible pour le moment.</p>
        {% endif %}
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const scenarioCards = document.querySelectorAll('.scenario-card');
    
    scenarioCards.forEach(card => {
        const descriptionDiv = card.querySelector('.scenario-description');
        const rulesContainer = card.querySelector('.scenario-rules-links');
        
        if (!descriptionDiv || !rulesContainer) return;
        
        // Lire le contenu texte (d√©j√† d√©cod√© par le navigateur)
        const description = descriptionDiv.textContent;
        
        // Chercher le pattern "R√®gles d'or appliqu√©es :" suivi de nombres
        const match = description.match(/R√®gles d['']or appliqu√©es[^:]*:\s*([0-9,\s]+)/i);
        
        if (match && match[1]) {
            // Extraire les num√©ros
            const ruleNumbers = match[1].trim().split(/[,\s]+/).filter(n => n && !isNaN(n));
            
            if (ruleNumbers.length > 0) {
                // Supprimer le texte "R√®gles d'or appliqu√©es" de la description pour √©viter la duplication
                const cleanDescription = descriptionDiv.innerHTML.replace(/R√®gles d['']or appliqu√©es[^:]*:\s*[0-9,\s]+/i, '').trim();
                descriptionDiv.innerHTML = cleanDescription;
                
                // Cr√©er le HTML avec les bons liens vers /rules/{id}
                let html = '<h4>üìã R√®gles d\'or √† appliquer :</h4><div class="rules-buttons">';
                ruleNumbers.forEach(num => {
                    html += `<a href="/rules/${num}" class="rule-link-button">R√®gle ${num}</a>`;
                });
                html += '</div>';
                rulesContainer.innerHTML = html;
                rulesContainer.style.display = 'block';
            }
        }
    });
});
</script>
{% endblock %}
