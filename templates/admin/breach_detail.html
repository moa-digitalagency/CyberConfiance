<!--
 * Nom de l'application : CyberConfiance
 * Description : Fichier breach_detail.html du projet CyberConfiance
 * Produit de : MOA Digital Agency, www.myoneart.com
 * Fait par : Aisance KALONJI, www.aisancekalonji.com
 * Auditer par : La CyberConfiance, www.cyberconfiance.com

-->

<!--
  CyberConfiance
  By MOA Digital Agency LLC
  Developed by: Aisance KALONJI
  Contact: moa@myoneart.com
  www.myoneart.com
-->
{% extends "admin/base.html" %}

{% block title %}D√©tails Analyse Fuite #{{ breach.id }} - Administration{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>D√©tails de l'Analyse de Fuite #{{ breach.id }}</h1>
    <p>R√©sultat complet de la v√©rification</p>
</div>

<div class="admin-card">
    <h3>Informations g√©n√©rales</h3>
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-top: 1rem;">
        <div>
            <strong style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Email v√©rifi√©:</strong>
            <span style="color: var(--text-primary); word-break: break-all;">{{ breach.email }}</span>
        </div>
        <div>
            <strong style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Nombre de fuites:</strong>
            {% if breach.breach_count > 5 %}
            <span class="badge badge-danger" style="font-size: 1.2rem; padding: 0.5rem 1rem;">{{ breach.breach_count }}</span>
            {% elif breach.breach_count > 0 %}
            <span class="badge badge-warning" style="font-size: 1.2rem; padding: 0.5rem 1rem;">{{ breach.breach_count }}</span>
            {% else %}
            <span class="badge badge-success" style="font-size: 1.2rem; padding: 0.5rem 1rem;">{{ breach.breach_count }}</span>
            {% endif %}
        </div>
        <div>
            <strong style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Niveau de risque:</strong>
            {% if breach.risk_level == 'critique' %}
            <span class="badge badge-danger" style="font-size: 1.1rem; padding: 0.5rem 1rem;">{{ breach.risk_level }}</span>
            {% elif breach.risk_level == '√©lev√©' %}
            <span class="badge badge-warning" style="font-size: 1.1rem; padding: 0.5rem 1rem;">{{ breach.risk_level }}</span>
            {% else %}
            <span class="badge badge-info" style="font-size: 1.1rem; padding: 0.5rem 1rem;">{{ breach.risk_level or 'Inconnu' }}</span>
            {% endif %}
        </div>
        <div>
            <strong style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Date de v√©rification:</strong>
            <span style="color: var(--text-primary);">{{ breach.created_at.strftime('%d/%m/%Y %H:%M:%S') }}</span>
        </div>
        <div>
            <strong style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Adresse IP:</strong>
            <span style="color: var(--text-primary);">{{ breach.ip_address }}</span>
        </div>
        <div>
            <strong style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">User Agent:</strong>
            <span style="color: var(--text-primary); font-size: 0.85rem; word-break: break-all;">{{ breach.user_agent }}</span>
        </div>
        {% if breach.document_code %}
        <div>
            <strong style="color: var(--text-secondary); display: block; margin-bottom: 0.5rem;">Code document:</strong>
            <span style="color: var(--accent-blue); font-family: monospace;">{{ breach.document_code }}</span>
        </div>
        {% endif %}
    </div>
</div>

{% if breach.breaches_found or breach.breaches_data %}
<div class="admin-card">
    <h3>Fuites de donn√©es d√©tect√©es</h3>
    
    {% if breach.breaches_data %}
    <div class="breaches-grid" style="display: grid; gap: 1rem; margin-top: 1rem;">
        {% for breach_item in breach.breaches_data %}
        <div class="breach-item" style="background: rgba(239, 68, 68, 0.08); padding: 1.25rem; border-radius: 10px; border: 1px solid rgba(239, 68, 68, 0.2);">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem;">
                <h4 style="margin: 0; color: #ef4444; font-size: 1.1rem;">{{ breach_item.Name or breach_item.name or 'Fuite inconnue' }}</h4>
                {% if breach_item.BreachDate or breach_item.breach_date %}
                <span class="badge badge-secondary" style="font-size: 0.8rem;">{{ breach_item.BreachDate or breach_item.breach_date }}</span>
                {% endif %}
            </div>
            
            {% if breach_item.Domain or breach_item.domain %}
            <p style="margin: 0.5rem 0; color: var(--text-secondary); font-size: 0.9rem;">
                <strong>Domaine:</strong> {{ breach_item.Domain or breach_item.domain }}
            </p>
            {% endif %}
            
            {% if breach_item.DataClasses or breach_item.data_classes %}
            <div style="margin-top: 0.75rem;">
                <strong style="color: var(--text-secondary); font-size: 0.85rem;">Donn√©es compromises:</strong>
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                    {% for data_class in (breach_item.DataClasses or breach_item.data_classes or []) %}
                    <span style="background: rgba(239, 68, 68, 0.15); color: #fca5a5; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem;">{{ data_class }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            {% if breach_item.Description or breach_item.description %}
            <p style="margin-top: 0.75rem; color: var(--text-muted); font-size: 0.85rem; line-height: 1.5;">
                {{ (breach_item.Description or breach_item.description)|striptags|truncate(200) }}
            </p>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% elif breach.breaches_found %}
    <div style="margin-top: 1rem;">
        <div class="breaches-list" style="display: flex; flex-wrap: wrap; gap: 0.75rem;">
            {% for breach_name in breach.breaches_found.split(',') %}
            {% if breach_name.strip() %}
            <div class="breach-tag" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); padding: 0.75rem 1.25rem; border-radius: 8px; display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: #ef4444; font-size: 1.1rem;">‚ö†Ô∏è</span>
                <span style="color: var(--text-primary); font-weight: 500;">{{ breach_name.strip() }}</span>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <div style="margin-top: 1.5rem; padding: 1.25rem; background: rgba(59, 130, 246, 0.1); border-radius: 10px; border: 1px solid rgba(59, 130, 246, 0.3);">
        <strong style="color: var(--accent-blue); font-size: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <span>üí°</span> Recommandations de s√©curit√©
        </strong>
        <ul style="margin-top: 0.75rem; color: var(--text-secondary); padding-left: 1.5rem; line-height: 1.8;">
            <li>Changer imm√©diatement les mots de passe des comptes affect√©s</li>
            <li>Activer l'authentification √† deux facteurs (2FA)</li>
            <li>Surveiller les activit√©s suspectes sur les comptes</li>
            <li>Ne jamais r√©utiliser le m√™me mot de passe</li>
            <li>Utiliser un gestionnaire de mots de passe</li>
        </ul>
    </div>
</div>
{% else %}
<div class="admin-card">
    <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
        <span style="font-size: 3rem; display: block; margin-bottom: 1rem;">‚úÖ</span>
        <span class="badge badge-success" style="font-size: 1.2rem; padding: 0.8rem 1.5rem;">Aucune fuite d√©tect√©e</span>
        <p style="margin-top: 1rem;">Cet email n'appara√Æt dans aucune base de donn√©es de fuites connues.</p>
    </div>
</div>
{% endif %}

<div style="margin-top: 2rem; display: flex; gap: 1rem;">
    <a href="{{ url_for('admin_panel.breach_history') }}" class="btn btn-secondary">‚Üê Retour √† l'historique</a>
    {% if breach.id %}
    <a href="/generate-breach-pdf/{{ breach.id }}" class="btn btn-primary" target="_blank">üìÑ T√©l√©charger le rapport PDF</a>
    {% endif %}
</div>
{% endblock %}
