{% extends "admin/base.html" %}

{% block title %}Gestion des articles - Administration{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Gestion des articles</h1>
    <p>Liste et gestion des articles de blog</p>
</div>

<div class="admin-toolbar">
    <div class="filter-group">
        <label for="category-filter">Catégorie:</label>
        <select id="category-filter" onchange="updateFilters()">
            <option value="">Toutes</option>
            {% for cat in categories %}
            <option value="{{ cat }}" {% if selected_category == cat %}selected{% endif %}>{{ cat }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="filter-group">
        <label for="source-filter">Source:</label>
        <select id="source-filter" onchange="updateFilters()">
            <option value="">Toutes</option>
            {% for src in sources %}
            <option value="{{ src }}" {% if selected_source == src %}selected{% endif %}>{{ src }}</option>
            {% endfor %}
        </select>
    </div>
    <a href="/my4dm1n/news/new/" class="btn btn-primary">Nouvel article</a>
</div>

<script>
function updateFilters() {
    const category = document.getElementById('category-filter').value;
    const source = document.getElementById('source-filter').value;
    let url = '?';
    if (category) url += 'category=' + encodeURIComponent(category) + '&';
    if (source) url += 'source=' + encodeURIComponent(source);
    window.location.href = url;
}
</script>

<div class="admin-card">
    <h3>Articles ({{ articles.total }})</h3>
    <table class="admin-table">
        <thead>
            <tr>
                <th>Titre</th>
                <th>Catégorie</th>
                <th>Source</th>
                <th>Date de publication</th>
                <th>Créé le</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for article in articles.items %}
            <tr>
                <td><strong>{{ article.title }}</strong></td>
                <td><span class="badge badge-info">{{ article.category }}</span></td>
                <td>{{ article.source or 'N/A' }}</td>
                <td>{{ article.published_date.strftime('%d/%m/%Y') if article.published_date else 'N/A' }}</td>
                <td>{{ article.created_at.strftime('%d/%m/%Y %H:%M') }}</td>
                <td>
                    <a href="/my4dm1n/news/edit/?id={{ article.id }}" class="btn btn-primary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem; margin-right: 0.5rem;">Modifier</a>
                    <a href="/my4dm1n/news/delete/?id={{ article.id }}" onclick="return confirm('Supprimer cet article ?')" class="btn" style="font-size: 0.85rem; padding: 0.4rem 0.8rem; background: rgba(239, 68, 68, 0.2); color: #fca5a5; border: 1px solid rgba(239, 68, 68, 0.3);">Supprimer</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    {% if articles.pages > 1 %}
    <div class="pagination">
        {% if articles.has_prev %}
        <a href="?page={{ articles.prev_num }}{% if selected_category %}&amp;category={{ selected_category|urlencode }}{% endif %}" class="btn btn-secondary">Précédent</a>
        {% endif %}
        
        <span>Page {{ articles.page }} sur {{ articles.pages }}</span>
        
        {% if articles.has_next %}
        <a href="?page={{ articles.next_num }}{% if selected_category %}&amp;category={{ selected_category|urlencode }}{% endif %}" class="btn btn-secondary">Suivant</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}
