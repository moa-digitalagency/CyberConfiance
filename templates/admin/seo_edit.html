<!--
 * Nom de l'application : CyberConfiance
 * Description : Fichier seo_edit.html du projet CyberConfiance
 * Produit de : MOA Digital Agency, www.myoneart.com
 * Fait par : Aisance KALONJI, www.aisancekalonji.com
 * Auditer par : La CyberConfiance, www.cyberconfiance.com

-->

<!--
  CyberConfiance
  By MOA Digital Agency LLC
  Developed by: Aisance KALONJI
  Contact: moa@myoneart.com
  www.myoneart.com
-->
{% extends "admin/base.html" %}

{% block title %}Éditer SEO - {{ seo.page_path }} - Administration{% endblock %}

{% block content %}
<div class="admin-header">
    <h1>Éditer les métadonnées SEO</h1>
    <p>Modification des paramètres SEO pour <strong style="color: var(--accent-blue);">{{ seo.page_path }}</strong></p>
</div>

<div class="admin-toolbar">
    <div class="toolbar-left">
        <a href="{{ url_for('admin_panel.seo_settings') }}" class="btn btn-secondary">&larr; Retour à la liste</a>
    </div>
</div>

<form method="POST" action="{{ url_for('admin_panel.seo_edit', seo_id=seo.id) }}" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
    
    <div class="admin-card">
        <h3 class="card-title">Informations de base</h3>
        <div class="form-grid">
            <div class="form-group full-width">
                <label class="form-label">Chemin de la page</label>
                <input type="text" name="page_path" value="{{ seo.page_path }}" required class="form-input">
                <span class="form-help">Exemple: /, /rules, /contact</span>
            </div>
            
            <div class="form-group full-width">
                <label class="form-label">Titre SEO</label>
                <input type="text" name="title" value="{{ seo.title or '' }}" class="form-input">
                <span class="form-help">Le titre qui apparaîtra dans les résultats de recherche</span>
            </div>
            
            <div class="form-group full-width">
                <label class="form-label">Description</label>
                <textarea name="description" class="form-input" rows="3">{{ seo.description or '' }}</textarea>
                <span class="form-help">Description qui apparaîtra dans les résultats de recherche (160 caractères max recommandés)</span>
            </div>
            
            <div class="form-group full-width">
                <label class="form-label">Mots-clés</label>
                <textarea name="keywords" class="form-input" rows="2">{{ seo.keywords or '' }}</textarea>
                <span class="form-help">Mots-clés séparés par des virgules</span>
            </div>
        </div>
    </div>

    <div class="admin-card">
        <h3 class="card-title">Open Graph (partage sur les réseaux sociaux)</h3>
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">OG Title</label>
                <input type="text" name="og_title" value="{{ seo.og_title or '' }}" class="form-input">
            </div>
            
            <div class="form-group full-width">
                <label class="form-label">OG Description</label>
                <textarea name="og_description" class="form-input" rows="2">{{ seo.og_description or '' }}</textarea>
            </div>
            
            <div class="form-group full-width">
                <label class="form-label">Image OG</label>
                <div class="image-upload-container">
                    {% if seo.og_image %}
                    <div class="current-image">
                        <img src="{{ seo.og_image }}" alt="Image OG actuelle" class="preview-image">
                        <span class="image-path">{{ seo.og_image }}</span>
                    </div>
                    {% endif %}
                    <div class="upload-options">
                        <div class="upload-option">
                            <label class="form-label-small">Télécharger une nouvelle image</label>
                            <input type="file" name="og_image_file" accept="image/*" class="form-input-file" id="og_image_file">
                        </div>
                        <div class="upload-divider">ou</div>
                        <div class="upload-option">
                            <label class="form-label-small">URL de l'image</label>
                            <input type="text" name="og_image" value="{{ seo.og_image or '' }}" class="form-input" placeholder="/static/img/og-default.png">
                        </div>
                    </div>
                    <div id="image-preview-container" style="display: none; margin-top: 1rem;">
                        <img id="image-preview" src="" alt="Aperçu" class="preview-image">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="admin-card">
        <h3 class="card-title">Paramètres avancés</h3>
        <div class="form-grid">
            <div class="form-group">
                <label class="form-label">URL Canonique</label>
                <input type="text" name="canonical_url" value="{{ seo.canonical_url or '' }}" class="form-input">
            </div>
            
            <div class="form-group">
                <label class="form-label">Robots</label>
                <input type="text" name="robots" value="{{ seo.robots or 'index, follow' }}" class="form-input">
            </div>
            
            <div class="form-group full-width">
                <label class="form-checkbox">
                    <input type="checkbox" name="is_active" {% if seo.is_active %}checked{% endif %}>
                    <span class="checkbox-label">Activer ces métadonnées SEO</span>
                </label>
            </div>
        </div>
    </div>

    <div class="form-actions">
        <a href="{{ url_for('admin_panel.seo_settings') }}" class="btn btn-secondary">Annuler</a>
        <button type="submit" class="btn btn-primary">Enregistrer les modifications</button>
    </div>
</form>

<div class="admin-card danger-zone">
    <h3 class="card-title danger">Zone de danger</h3>
    <p class="danger-text">Supprimer définitivement cette entrée SEO. Cette action est irréversible.</p>
    <form method="POST" action="{{ url_for('admin_panel.seo_delete', seo_id=seo.id) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette entrée SEO pour {{ seo.page_path }} ?')">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <button type="submit" class="btn btn-danger">Supprimer cette entrée SEO</button>
    </form>
</div>

<style>
.admin-card {
    background: rgba(10, 22, 40, 0.8);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.card-title {
    color: var(--text-primary);
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 1.5rem 0;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid rgba(59, 130, 246, 0.2);
}

.card-title.danger {
    color: #ef4444;
    border-bottom-color: rgba(239, 68, 68, 0.3);
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.25rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group.full-width {
    grid-column: span 2;
}

.form-label {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.form-label-small {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-bottom: 0.35rem;
}

.form-input {
    background: rgba(15, 30, 50, 0.8);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    color: var(--text-primary);
    font-size: 0.95rem;
    transition: all 0.2s ease;
    width: 100%;
}

.form-input:focus {
    outline: none;
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.form-input::placeholder {
    color: var(--text-secondary);
    opacity: 0.6;
}

textarea.form-input {
    resize: vertical;
    min-height: 80px;
}

.form-help {
    color: var(--text-secondary);
    font-size: 0.8rem;
    margin-top: 0.35rem;
}

.form-checkbox {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    cursor: pointer;
    padding: 0.5rem 0;
}

.form-checkbox input[type="checkbox"] {
    width: 20px;
    height: 20px;
    accent-color: var(--accent-blue);
    cursor: pointer;
}

.checkbox-label {
    color: var(--text-primary);
    font-size: 0.95rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-bottom: 2rem;
}

.image-upload-container {
    background: rgba(15, 30, 50, 0.5);
    border: 1px dashed rgba(59, 130, 246, 0.4);
    border-radius: 10px;
    padding: 1.25rem;
}

.current-image {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid rgba(59, 130, 246, 0.2);
}

.preview-image {
    max-width: 120px;
    max-height: 80px;
    border-radius: 6px;
    object-fit: cover;
    border: 1px solid rgba(59, 130, 246, 0.3);
}

.image-path {
    color: var(--text-secondary);
    font-size: 0.85rem;
    font-family: monospace;
}

.upload-options {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 1rem;
    align-items: end;
}

.upload-divider {
    color: var(--text-secondary);
    font-size: 0.85rem;
    padding-bottom: 0.5rem;
}

.upload-option {
    display: flex;
    flex-direction: column;
}

.form-input-file {
    background: rgba(15, 30, 50, 0.8);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 8px;
    padding: 0.5rem;
    color: var(--text-primary);
    font-size: 0.9rem;
    cursor: pointer;
}

.form-input-file::file-selector-button {
    background: var(--accent-blue);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 0.4rem 0.8rem;
    margin-right: 0.75rem;
    cursor: pointer;
    font-size: 0.85rem;
}

.form-input-file::file-selector-button:hover {
    background: #2563eb;
}

.danger-zone {
    border-color: rgba(239, 68, 68, 0.3);
}

.danger-text {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 1rem;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .form-group.full-width {
        grid-column: span 1;
    }
    
    .upload-options {
        grid-template-columns: 1fr;
    }
    
    .upload-divider {
        text-align: center;
        padding: 0.5rem 0;
    }
}
</style>

<script>
document.getElementById('og_image_file').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('image-preview').src = e.target.result;
            document.getElementById('image-preview-container').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
